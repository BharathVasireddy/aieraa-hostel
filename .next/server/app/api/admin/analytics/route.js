"use strict";(()=>{var e={};e.id=678,e.ids=[678],e.modules={1708:e=>{e.exports=require("node:process")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{e.exports=require("node:tty")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{e.exports=require("querystring")},12412:e=>{e.exports=require("assert")},12909:(e,t,r)=>{r.d(t,{N:()=>s});var n=r(13581),a=r(85663),i=r(31183),o=r(38824);let s={providers:[(0,n.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await i.z.user.findUnique({where:{email:e.email},include:{university:!0}});if(!t||!await a.Ay.compare(e.password,t.password))return null;if(t.status!==o.UserStatus.APPROVED)throw Error("Account pending approval or suspended");return await i.z.user.update({where:{id:t.id},data:{lastLoginAt:new Date}}),{id:t.id,email:t.email,name:t.name,role:t.role,status:t.status,universityId:t.universityId,university:t.university.name,image:t.profileImage}}})],session:{strategy:"jwt"},callbacks:{async jwt({token:e,user:t}){if(t&&(e.id=t.id,e.role=t.role,e.status=t.status,e.universityId=t.universityId,e.university=t.university),e.id)try{let t=await i.z.user.findUnique({where:{id:e.id},select:{id:!0,status:!0,forcedLogoutAt:!0}});if(!t||"APPROVED"!==t.status)return e.invalid=!0,e;if(t.forcedLogoutAt&&e.iat&&"number"==typeof e.iat){let r=new Date(1e3*e.iat);t.forcedLogoutAt>r&&(e.invalid=!0)}}catch(t){console.error("Error validating user in JWT callback:",t),e.invalid=!0}return e},session:async({session:e,token:t})=>t.invalid?null:(t&&(e.user={id:t.id,email:t.email,name:t.name,role:t.role,status:t.status,universityId:t.universityId,university:t.university,image:t.picture}),e)},pages:{signIn:"/auth/signin",error:"/auth/signin"}}},16698:e=>{e.exports=require("node:async_hooks")},23536:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>en,routeModule:()=>Z,serverHooks:()=>er,workAsyncStorage:()=>ee,workUnitAsyncStorage:()=>et});var n={};r.r(n),r.d(n,{GET:()=>K});var a=r(96559),i=r(48088),o=r(37719),s=r(32190),u=r(31183);let l=Symbol.for("constructDateFrom");function d(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&l in e?e[l](t):e instanceof Date?new e.constructor(t):new Date(t)}function c(e,t){return d(t||e,e)}function h(e,t){let r=c(e,t?.in);return r.setHours(0,0,0,0),r}function m(e,t){let r=c(e,t?.in);return r.setHours(23,59,59,999),r}function f(e,t,r){var n=-t;let a=c(e,r?.in);return isNaN(n)?d(r?.in||e,NaN):(n&&a.setDate(a.getDate()+n),a)}let g={};function w(e,t){let r=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??g.weekStartsOn??g.locale?.options?.weekStartsOn??0,n=c(e,t?.in),a=n.getDay();return n.setDate(n.getDate()-(7*(a<r)+a-r)),n.setHours(0,0,0,0),n}function y(e,t){let r=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??g.weekStartsOn??g.locale?.options?.weekStartsOn??0,n=c(e,t?.in),a=n.getDay();return n.setDate(n.getDate()+((a<r?-7:0)+6-(a-r))),n.setHours(23,59,59,999),n}function p(e,t){let r=c(e,t?.in);return r.setDate(1),r.setHours(0,0,0,0),r}function b(e,t){let r=c(e,t?.in),n=r.getMonth();return r.setFullYear(r.getFullYear(),n+1,0),r.setHours(23,59,59,999),r}let v={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function M(e){return (t={})=>{let r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}let x={date:M({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:M({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:M({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},k={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function S(e){return(t,r)=>{let n;if("formatting"===(r?.context?String(r.context):"standalone")&&e.formattingValues){let t=e.defaultFormattingWidth||e.defaultWidth,a=r?.width?String(r.width):t;n=e.formattingValues[a]||e.formattingValues[t]}else{let t=e.defaultWidth,a=r?.width?String(r.width):e.defaultWidth;n=e.values[a]||e.values[t]}return n[e.argumentCallback?e.argumentCallback(t):t]}}function P(e){return(t,r={})=>{let n,a=r.width,i=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],o=t.match(i);if(!o)return null;let s=o[0],u=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(u)?function(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}(u,e=>e.test(s)):function(e,t){for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}(u,e=>e.test(s));return n=e.valueCallback?e.valueCallback(l):l,{value:n=r.valueCallback?r.valueCallback(n):n,rest:t.slice(s.length)}}}let D={code:"en-US",formatDistance:(e,t,r)=>{let n,a=v[e];if(n="string"==typeof a?a:1===t?a.one:a.other.replace("{{count}}",t.toString()),r?.addSuffix)if(r.comparison&&r.comparison>0)return"in "+n;else return n+" ago";return n},formatLong:x,formatRelative:(e,t,r,n)=>k[e],localize:{ordinalNumber:(e,t)=>{let r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},era:S({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:S({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:S({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:S({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:S({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:function(e){return(t,r={})=>{let n=t.match(e.matchPattern);if(!n)return null;let a=n[0],i=t.match(e.parsePattern);if(!i)return null;let o=e.valueCallback?e.valueCallback(i[0]):i[0];return{value:o=r.valueCallback?r.valueCallback(o):o,rest:t.slice(a.length)}}}({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:P({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:P({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:P({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:P({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:P({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function q(e){let t=c(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),e-r}function A(e,t){return w(e,{...t,weekStartsOn:1})}function E(e,t){let r=c(e,t?.in),n=r.getFullYear(),a=d(r,0);a.setFullYear(n+1,0,4),a.setHours(0,0,0,0);let i=A(a),o=d(r,0);o.setFullYear(n,0,4),o.setHours(0,0,0,0);let s=A(o);return r.getTime()>=i.getTime()?n+1:r.getTime()>=s.getTime()?n:n-1}function N(e,t){let r=c(e,t?.in),n=r.getFullYear(),a=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??g.firstWeekContainsDate??g.locale?.options?.firstWeekContainsDate??1,i=d(t?.in||e,0);i.setFullYear(n+1,0,a),i.setHours(0,0,0,0);let o=w(i,t),s=d(t?.in||e,0);s.setFullYear(n,0,a),s.setHours(0,0,0,0);let u=w(s,t);return+r>=+o?n+1:+r>=+u?n:n-1}function W(e,t){let r=Math.abs(e).toString().padStart(t,"0");return(e<0?"-":"")+r}let T={y(e,t){let r=e.getFullYear(),n=r>0?r:1-r;return W("yy"===t?n%100:n,t.length)},M(e,t){let r=e.getMonth();return"M"===t?String(r+1):W(r+1,2)},d:(e,t)=>W(e.getDate(),t.length),a(e,t){let r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];default:return"am"===r?"a.m.":"p.m."}},h:(e,t)=>W(e.getHours()%12||12,t.length),H:(e,t)=>W(e.getHours(),t.length),m:(e,t)=>W(e.getMinutes(),t.length),s:(e,t)=>W(e.getSeconds(),t.length),S(e,t){let r=t.length;return W(Math.trunc(e.getMilliseconds()*Math.pow(10,r-3)),t.length)}},I={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},O={G:function(e,t,r){let n=+(e.getFullYear()>0);switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if("yo"===t){let t=e.getFullYear();return r.ordinalNumber(t>0?t:1-t,{unit:"year"})}return T.y(e,t)},Y:function(e,t,r,n){let a=N(e,n),i=a>0?a:1-a;return"YY"===t?W(i%100,2):"Yo"===t?r.ordinalNumber(i,{unit:"year"}):W(i,t.length)},R:function(e,t){return W(E(e),t.length)},u:function(e,t){return W(e.getFullYear(),t.length)},Q:function(e,t,r){let n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return W(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){let n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return W(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){let n=e.getMonth();switch(t){case"M":case"MM":return T.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){let n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return W(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){let a=function(e,t){let r=c(e,t?.in);return Math.round((w(r,t)-function(e,t){let r=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??g.firstWeekContainsDate??g.locale?.options?.firstWeekContainsDate??1,n=N(e,t),a=d(t?.in||e,0);return a.setFullYear(n,0,r),a.setHours(0,0,0,0),w(a,t)}(r,t))/6048e5)+1}(e,n);return"wo"===t?r.ordinalNumber(a,{unit:"week"}):W(a,t.length)},I:function(e,t,r){let n=function(e,t){let r=c(e,void 0);return Math.round((A(r)-function(e,t){let r=E(e,void 0),n=d(e,0);return n.setFullYear(r,0,4),n.setHours(0,0,0,0),A(n)}(r))/6048e5)+1}(e);return"Io"===t?r.ordinalNumber(n,{unit:"week"}):W(n,t.length)},d:function(e,t,r){return"do"===t?r.ordinalNumber(e.getDate(),{unit:"date"}):T.d(e,t)},D:function(e,t,r){let n=function(e,t){let r=c(e,void 0);return function(e,t,r){let[n,a]=function(e,...t){let r=d.bind(null,e||t.find(e=>"object"==typeof e));return t.map(r)}(void 0,e,t),i=h(n),o=h(a);return Math.round((i-q(i)-(o-q(o)))/864e5)}(r,function(e,t){let r=c(e,void 0);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}(r))+1}(e);return"Do"===t?r.ordinalNumber(n,{unit:"dayOfYear"}):W(n,t.length)},E:function(e,t,r){let n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){let a=e.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return W(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(a,{width:"short",context:"formatting"});default:return r.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){let a=e.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return W(i,t.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(a,{width:"narrow",context:"standalone"});case"cccccc":return r.day(a,{width:"short",context:"standalone"});default:return r.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,r){let n=e.getDay(),a=0===n?7:n;switch(t){case"i":return String(a);case"ii":return W(a,t.length);case"io":return r.ordinalNumber(a,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){let n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,t,r){let n,a=e.getHours();switch(n=12===a?I.noon:0===a?I.midnight:a/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,t,r){let n,a=e.getHours();switch(n=a>=17?I.evening:a>=12?I.afternoon:a>=4?I.morning:I.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,t,r){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),r.ordinalNumber(t,{unit:"hour"})}return T.h(e,t)},H:function(e,t,r){return"Ho"===t?r.ordinalNumber(e.getHours(),{unit:"hour"}):T.H(e,t)},K:function(e,t,r){let n=e.getHours()%12;return"Ko"===t?r.ordinalNumber(n,{unit:"hour"}):W(n,t.length)},k:function(e,t,r){let n=e.getHours();return(0===n&&(n=24),"ko"===t)?r.ordinalNumber(n,{unit:"hour"}):W(n,t.length)},m:function(e,t,r){return"mo"===t?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):T.m(e,t)},s:function(e,t,r){return"so"===t?r.ordinalNumber(e.getSeconds(),{unit:"second"}):T.s(e,t)},S:function(e,t){return T.S(e,t)},X:function(e,t,r){let n=e.getTimezoneOffset();if(0===n)return"Z";switch(t){case"X":return Y(n);case"XXXX":case"XX":return C(n);default:return C(n,":")}},x:function(e,t,r){let n=e.getTimezoneOffset();switch(t){case"x":return Y(n);case"xxxx":case"xx":return C(n);default:return C(n,":")}},O:function(e,t,r){let n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+z(n,":");default:return"GMT"+C(n,":")}},z:function(e,t,r){let n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+z(n,":");default:return"GMT"+C(n,":")}},t:function(e,t,r){return W(Math.trunc(e/1e3),t.length)},T:function(e,t,r){return W(+e,t.length)}};function z(e,t=""){let r=e>0?"-":"+",n=Math.abs(e),a=Math.trunc(n/60),i=n%60;return 0===i?r+String(a):r+String(a)+t+W(i,2)}function Y(e,t){return e%60==0?(e>0?"-":"+")+W(Math.abs(e)/60,2):C(e,t)}function C(e,t=""){let r=Math.abs(e);return(e>0?"-":"+")+W(Math.trunc(r/60),2)+t+W(r%60,2)}let j=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},F=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},H={p:F,P:(e,t)=>{let r,n=e.match(/(P+)(p+)?/)||[],a=n[1],i=n[2];if(!i)return j(e,t);switch(a){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;default:r=t.dateTime({width:"full"})}return r.replace("{{date}}",j(a,t)).replace("{{time}}",F(i,t))}},R=/^D+$/,L=/^Y+$/,G=["D","DD","YY","YYYY"],U=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,B=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Q=/^'([^]*?)'?$/,X=/''/g,_=/[a-zA-Z]/;function J(e,t,r){let n=r?.locale??g.locale??D,a=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??g.firstWeekContainsDate??g.locale?.options?.firstWeekContainsDate??1,i=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??g.weekStartsOn??g.locale?.options?.weekStartsOn??0,o=c(e,r?.in);if(!(o instanceof Date||"object"==typeof o&&"[object Date]"===Object.prototype.toString.call(o))&&"number"!=typeof o||isNaN(+c(o)))throw RangeError("Invalid time value");let s=t.match(B).map(e=>{let t=e[0];return"p"===t||"P"===t?(0,H[t])(e,n.formatLong):e}).join("").match(U).map(e=>{if("''"===e)return{isToken:!1,value:"'"};let t=e[0];if("'"===t)return{isToken:!1,value:function(e){let t=e.match(Q);return t?t[1].replace(X,"'"):e}(e)};if(O[t])return{isToken:!0,value:e};if(t.match(_))throw RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});n.localize.preprocessor&&(s=n.localize.preprocessor(o,s));let u={firstWeekContainsDate:a,weekStartsOn:i,locale:n};return s.map(a=>{if(!a.isToken)return a.value;let i=a.value;return(!r?.useAdditionalWeekYearTokens&&L.test(i)||!r?.useAdditionalDayOfYearTokens&&R.test(i))&&function(e,t,r){let n=function(e,t,r){let n="Y"===e[0]?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(e,t,r);if(console.warn(n),G.includes(e))throw RangeError(n)}(i,t,String(e)),(0,O[i[0]])(o,i,n.localize,u)}).join("")}var V=r(35426),$=r(12909);async function K(e){try{let t,r,n,a;console.log("\uD83D\uDCCA Analytics API called");let i=await (0,V.getServerSession)($.N);if(!i||"ADMIN"!==i.user.role&&"MANAGER"!==i.user.role)return console.log("❌ Analytics: No session found or insufficient permissions"),s.NextResponse.json({error:"Unauthorized"},{status:401});console.log("\uD83D\uDC64 Analytics: User authenticated:",i.user.email);let o=await u.z.user.findUnique({where:{email:i.user.email},include:{university:!0}});if(!o)return console.log("❌ Analytics: User not found in database"),s.NextResponse.json({error:"User not found"},{status:404});if(console.log("\uD83C\uDFAF Analytics: User role:",o.role,"University:",o.university?.name),!["ADMIN","MANAGER"].includes(o.role))return console.log("❌ Analytics: Insufficient permissions for role:",o.role),s.NextResponse.json({error:"Insufficient permissions"},{status:403});let{searchParams:l}=new URL(e.url),d=l.get("period")||"week",c=new Date;switch(d){case"day":t=h(c),r=m(c),n=h(f(c,1)),a=m(f(c,1));break;case"week":default:t=w(c),r=y(c),n=w(f(c,7)),a=y(f(c,7));break;case"month":t=p(c),r=b(c),n=p(f(c,30)),a=b(f(c,30))}let g={};"MANAGER"===o.role&&(g.universityId=o.universityId);let v={...g,createdAt:{gte:t,lte:r}},M={...g,createdAt:{gte:n,lte:a}},[x,k,S,P,D,q,A,E,N,W]=await Promise.all([u.z.order.findMany({where:v,select:{id:!0,totalAmount:!0,status:!0,createdAt:!0,orderItems:{select:{quantity:!0,price:!0,menuItem:{select:{id:!0,name:!0,categories:!0}}}}}}),u.z.order.aggregate({where:{...v,status:"SERVED"},_sum:{totalAmount:!0}}),u.z.order.count({where:M}),u.z.order.aggregate({where:{...M,status:"SERVED"},_sum:{totalAmount:!0}}),u.z.user.count({where:{..."MANAGER"===o.role?{universityId:o.universityId}:{},role:"STUDENT"}}),u.z.user.count({where:{..."MANAGER"===o.role?{universityId:o.universityId}:{},role:"STUDENT",orders:{some:{createdAt:{gte:t,lte:r}}}}}),u.z.orderItem.groupBy({by:["menuItemId"],where:{order:v},_sum:{quantity:!0,price:!0},_count:{id:!0},orderBy:{_sum:{quantity:"desc"}},take:10}),u.z.order.findMany({where:v,select:{orderItems:{select:{menuItem:{select:{categories:!0}}}}}}),u.z.order.groupBy({by:["status"],where:v,_count:{id:!0},_sum:{totalAmount:!0}}),u.z.order.findMany({where:v,select:{createdAt:!0,totalAmount:!0,status:!0},orderBy:{createdAt:"asc"}})]),T=k._sum.totalAmount||0,I=P._sum.totalAmount||0,O=S>0?(x.length-S)/S*100:0,z=x.length>0?T/x.length:0,Y=x.filter(e=>"SERVED"===e.status).length,C=x.length>0?Y/x.length*100:0,j=[],F="day"===d?1:"week"===d?7:30;for(let e=0;e<F;e++){let n=new Date(t);if(n.setDate(t.getDate()+e),n>r)break;let a=W.filter(e=>new Date(e.createdAt).toDateString()===n.toDateString()),i=a.filter(e=>"SERVED"===e.status).reduce((e,t)=>e+t.totalAmount,0);j.push({date:J(n,"yyyy-MM-dd"),dayName:J(n,"day"===d?"HH:mm":"EEE"),revenue:i,orders:a.length})}let H=A.map(e=>e.menuItemId),R=H.length>0?await u.z.menuItem.findMany({where:{id:{in:H}},select:{id:!0,name:!0,categories:!0}}):[],L=A.map(e=>{let t=R.find(t=>t.id===e.menuItemId);return{id:e.menuItemId,name:t?.name||"Unknown Item",category:t?.categories?.[0]||"UNKNOWN",orders:e._count.id,quantity:e._sum.quantity||0,revenue:e._sum.price||0}}),G=new Map;E.forEach(e=>{e.orderItems.forEach(e=>{(e.menuItem.categories||[]).forEach(e=>{G.set(e,(G.get(e)||0)+1)})})});let U=Array.from(G.entries()).map(([e,t])=>({category:e,_count:t})),B={period:d,dateRange:{start:J(t,"yyyy-MM-dd"),end:J(r,"yyyy-MM-dd")},keyMetrics:{totalRevenue:T,revenueGrowth:I>0?(T-I)/I*100:0,totalOrders:x.length,orderGrowth:O,avgOrderValue:z,activeStudents:q,totalStudents:D,orderSuccessRate:C},dailyData:j,popularItems:L,categoryBreakdown:U,orderStatusStats:N,studentSegments:{heavy:{count:Math.floor(.1*q),avgSpend:3*z},regular:{count:Math.floor(.3*q),avgSpend:1.5*z},occasional:{count:Math.floor(.4*q),avgSpend:.8*z},new:{count:Math.floor(.2*q),avgSpend:.5*z}}};return console.log("✅ Analytics: Successfully calculated analytics data"),s.NextResponse.json(B)}catch(e){return console.error("❌ Analytics API Error:"),console.error("Error message:",e instanceof Error?e.message:String(e)),console.error("Error stack:",e instanceof Error?e.stack:"No stack trace"),console.error("Full error:",e),s.NextResponse.json({error:"Failed to fetch analytics data"},{status:500})}}let Z=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/analytics/route",pathname:"/api/admin/analytics",filename:"route",bundlePath:"app/api/admin/analytics/route"},resolvedPagePath:"/Users/bharat/Desktop/aieraa-hostel/src/app/api/admin/analytics/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:ee,workUnitAsyncStorage:et,serverHooks:er}=Z;function en(){return(0,o.patchFetch)({workAsyncStorage:ee,workUnitAsyncStorage:et})}},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31183:(e,t,r)=>{r.d(t,{z:()=>a});var n=r(38824);let a=globalThis.prisma??new n.PrismaClient},31421:e=>{e.exports=require("node:child_process")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{e.exports=require("node:os")},51455:e=>{e.exports=require("node:fs/promises")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},74075:e=>{e.exports=require("zlib")},76760:e=>{e.exports=require("node:path")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},81630:e=>{e.exports=require("http")},94735:e=>{e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[4243,580,5663,3112,1748],()=>r(23536));module.exports=n})();