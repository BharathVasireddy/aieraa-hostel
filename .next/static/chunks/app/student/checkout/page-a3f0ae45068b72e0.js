(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4663],{1586:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},3734:(e,s,a)=>{Promise.resolve().then(a.bind(a,8429))},5196:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},7809:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},8136:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},8429:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>j});var r=a(5155),t=a(7809),l=a(1007),i=a(8883),n=a(9420),c=a(8136),d=a(7340),o=a(4186),h=a(1586),x=a(5196),m=a(2115),u=a(5695),p=a(7163),g=a(958),y=a(7198);function j(){var e,s,a,j,b;let N=(0,u.useRouter)(),{user:f}=(0,y.J)(),[v,w]=(0,m.useState)(null),[k,A]=(0,m.useState)([]),[M,S]=(0,m.useState)(!0),[C,P]=(0,m.useState)(!1),[D,O]=(0,m.useState)(""),[z,I]=(0,m.useState)("razorpay"),[q,E]=(0,m.useState)("");(0,m.useEffect)(()=>{(async()=>{S(!0);let e=localStorage.getItem("orderCart");if(!e)return N.push("/student/menu");let s=JSON.parse(e);if(w(s),(0,g.M9)(s.orderDate)){E("Ordering deadline has passed for this date. Please select a different date."),S(!1);return}try{let e=await fetch("/api/menu?date=".concat(s.orderDate)),a=await e.json();if(a.success){let e=Object.entries(s.items).map(e=>{let[s,r]=e,t=s.includes("-")?s.split("-")[0]:s,l=s.includes("-")?s.split("-")[1]:null,i=a.menuItems.find(e=>e.id===t);if(i){let e=i.price,a=i.name;if(l&&i.variations&&i.variations.length>0){let s=i.variations.find(e=>e.id===l);s&&(e=s.price,a="".concat(i.name," (").concat(s.name,")"))}else if(i.variations&&i.variations.length>0){let s=i.variations.find(e=>e.isDefault);s&&(e=s.price,a="".concat(i.name," (").concat(s.name,")"))}let t=i.offerPrice&&i.offerPrice<e?i.offerPrice:e;return{id:s,name:a,quantity:r,price:t}}return{id:s,name:"Item ".concat(s),quantity:r,price:100}});A(e)}else E("Failed to load menu items")}catch(e){console.error("Error loading menu items:",e),E("Failed to load menu items")}finally{S(!1)}})()},[N]);let R=async()=>{if(!v||!f)return void E("Missing cart or user data");P(!0),E("");try{let e={orderDate:v.orderDate,items:Object.entries(v.items).map(e=>{let[s,a]=e;return{menuItemId:s,quantity:a,notes:D}}),specialInstructions:D,paymentMethod:z,totalAmount:v.totalAmount},s=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await s.json();s.ok?(localStorage.removeItem("orderCart"),localStorage.removeItem("tempCart"),N.push("/student/order-success?orderId=".concat(a.order.id,"&orderNumber=").concat(a.order.orderNumber))):E(a.error||"Failed to place order")}catch(e){console.error("Error placing order:",e),E("Failed to place order. Please try again.")}finally{P(!1)}};if(!f)return(0,r.jsx)(p.A,{showDatePicker:!1,children:(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-green-600 border-t-transparent rounded-full animate-spin"})})});if(M)return(0,r.jsx)(p.A,{showDatePicker:!1,children:(0,r.jsx)("div",{className:"px-4 py-6",children:(0,r.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,r.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/4 mx-auto"}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 space-y-3",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})})});if(q&&!v)return(0,r.jsx)(p.A,{showDatePicker:!1,children:(0,r.jsx)("div",{className:"px-4 py-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-red-600 mb-4",children:q}),(0,r.jsx)("button",{onClick:()=>N.push("/student/menu"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Back to Menu"})]})})});let _=k.reduce((e,s)=>e+s.price*s.quantity,0),F=Math.round(_*((null==(s=f.university)||null==(e=s.settings)?void 0:e.taxRate)||.1)),T=_+F;return(0,r.jsxs)(p.A,{showDatePicker:!1,children:[(0,r.jsxs)("div",{className:"px-4 py-6 pb-32",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Order Summary"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Review your order before placing"})]}),q&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,r.jsx)("p",{className:"text-red-800 text-sm",children:q})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 border border-gray-100 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,r.jsx)(t.A,{className:"w-5 h-5 text-green-600"}),(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:"Your Order"}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["(",k.length," items)"]})]}),(0,r.jsx)("div",{className:"space-y-3",children:k.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Quantity: ",e.quantity]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("span",{className:"font-semibold text-gray-900",children:["₹",e.price*e.quantity]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["₹",e.price," each"]})]})]},e.id))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 border border-gray-100 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,r.jsx)(l.A,{className:"w-5 h-5 text-green-600"}),(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:"Student Details"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(l.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-gray-900",children:f.name})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(i.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-gray-900",children:f.email})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(n.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-gray-900",children:f.phone||"Not provided"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(c.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"text-gray-900",children:null==(a=f.university)?void 0:a.name})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(d.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsxs)("span",{className:"text-gray-900",children:["Room ",f.roomNumber]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(o.A,{className:"w-4 h-4 text-gray-400"}),(0,r.jsxs)("span",{className:"text-gray-900",children:["Meal Date: ",v?new Date(v.orderDate).toLocaleDateString():""]})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 border border-gray-100 shadow-sm",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Special Instructions"}),(0,r.jsx)("textarea",{value:D,onChange:e=>O(e.target.value),placeholder:"Any special requests or dietary notes...",className:"w-full p-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 resize-none",rows:3})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 border border-gray-100 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,r.jsx)(h.A,{className:"w-5 h-5 text-green-600"}),(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:"Payment Method"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",value:"razorpay",checked:"razorpay"===z,onChange:e=>I(e.target.value),className:"w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500"}),(0,r.jsx)("span",{className:"text-gray-900",children:"Pay Online (Razorpay)"})]}),(0,r.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",value:"cash",checked:"cash"===z,onChange:e=>I(e.target.value),className:"w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500"}),(0,r.jsx)("span",{className:"text-gray-900",children:"Pay at Collection Counter"})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-6 border border-gray-100 shadow-sm",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Bill Summary"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,r.jsx)("span",{children:"Subtotal"}),(0,r.jsxs)("span",{children:["₹",_]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,r.jsxs)("span",{children:["Tax (",Math.round(100*((null==(b=f.university)||null==(j=b.settings)?void 0:j.taxRate)||.1)),"%)"]}),(0,r.jsxs)("span",{children:["₹",F]})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 pt-2 mt-2",children:(0,r.jsxs)("div",{className:"flex justify-between text-lg font-semibold text-gray-900",children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsxs)("span",{children:["₹",T]})]})})]})]})]}),(0,r.jsx)("div",{className:"fixed bottom-16 left-0 right-0 bg-white border-t border-gray-200 p-4 z-50",children:(0,r.jsx)("button",{onClick:R,disabled:C||0===k.length,className:"w-full py-4 rounded-xl font-semibold text-lg transition-all duration-200 ".concat(C||0===k.length?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700 active:scale-98 shadow-lg"),children:C?(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,r.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{children:"Placing Order..."})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,r.jsx)(x.A,{className:"w-5 h-5"}),(0,r.jsxs)("span",{children:["Place Order - ₹",T]})]})})})]})}},8883:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},9420:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[6454,4691,7163,8441,1684,7358],()=>s(3734)),_N_E=e.O()}]);